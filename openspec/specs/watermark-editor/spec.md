# watermark-editor Specification

## Purpose
TBD - created by archiving change add-watermark-editor-ui. Update Purpose after archive.
## Requirements
### Requirement: 水印文字配置
系统 SHALL 允许用户通过文本框双击编辑或工具栏配置水印文字内容。

#### Scenario: 双击编辑水印文字
- **WHEN** 用户双击文本框
- **THEN** 进入编辑模式，可直接修改文字内容
- **AND** 预览区域实时显示修改后的水印文字

#### Scenario: 空文字处理
- **WHEN** 文本框文字为空
- **THEN** 文本框显示占位符提示"请输入文字"

---

### Requirement: 水印颜色配置
系统 SHALL 允许用户通过浮动工具栏配置水印颜色。

#### Scenario: 选择水印颜色
- **WHEN** 用户通过浮动工具栏的颜色选择器选择颜色
- **THEN** 选中文本框的水印颜色实时更新

#### Scenario: 白色预设显示
- **WHEN** 颜色选择器显示预设颜色
- **THEN** 白色预设 SHALL 显示边框以便在浅色背景下可见

---

### Requirement: 水印透明度配置
系统 SHALL 允许用户通过浮动工具栏配置水印透明度（0-100%）。

#### Scenario: 调整透明度
- **WHEN** 用户在浮动工具栏拖动透明度滑块
- **THEN** 选中文本框的水印透明度实时更新
- **AND** 透明度范围为 0%（完全透明）到 100%（完全不透明）

---

### Requirement: 水印大小配置
系统 SHALL 允许用户通过拖拽文本框边框或浮动工具栏配置水印字体大小。

#### Scenario: 拖拽调整字体大小
- **WHEN** 用户拖拽文本框边框调整大小
- **THEN** 字体大小随文本框大小等比例变化

#### Scenario: 工具栏调整字体大小
- **WHEN** 用户在浮动工具栏调整字体大小
- **THEN** 选中文本框的字体大小实时更新
- **AND** 字体大小范围为 12px 到 200px

---

### Requirement: 水印角度配置
系统 SHALL 允许用户通过拖拽旋转手柄配置水印旋转角度。

#### Scenario: 拖拽调整旋转角度
- **WHEN** 用户拖拽文本框的旋转手柄
- **THEN** 文本框角度实时变化
- **AND** 角度范围为 -180° 到 180°

---

### Requirement: 图片上传
系统 SHALL 支持用户上传图片文件，通过底部区域操作。

#### Scenario: 拖拽上传图片
- **WHEN** 用户将图片文件拖拽到图片显示区域
- **THEN** 图片加载并显示在预览区域
- **AND** 图片添加到底部缩略图列表

#### Scenario: 点击上传图片
- **WHEN** 用户点击底部添加按钮并选择图片文件
- **THEN** 图片加载并显示在预览区域
- **AND** 图片添加到底部缩略图列表

#### Scenario: 批量上传图片
- **WHEN** 用户上传多张图片
- **THEN** 所有图片显示在底部缩略图列表
- **AND** 第一张图片显示在预览区域

#### Scenario: 文件类型校验
- **WHEN** 用户上传非图片文件
- **THEN** 显示错误提示"仅支持 PNG、JPG、JPEG、WebP 格式"
- **AND** 不加载该文件

---

### Requirement: 图片导出
系统 SHALL 支持将带水印的图片导出下载。

#### Scenario: 导出 PNG 格式
- **WHEN** 用户选择 PNG 格式并点击导出
- **THEN** 下载带水印的 PNG 图片
- **AND** 图片保持原始分辨率
- **AND** 文本框水印和平铺水印（如启用）都被渲染

#### Scenario: 导出 JPG 格式
- **WHEN** 用户选择 JPG 格式并点击导出
- **THEN** 显示质量控制滑块（0-100%）
- **AND** 下载带水印的 JPG 图片

#### Scenario: 批量导出 zip
- **GIVEN** 底部缩略图有多张图片
- **WHEN** 用户点击导出
- **THEN** 所有图片应用相同的水印配置后打包为 zip 文件下载

---

### Requirement: 实时预览
系统 SHALL 在用户调整任何水印参数时实时更新预览。

#### Scenario: 参数变化实时预览
- **WHEN** 用户调整任何水印参数（文字/颜色/透明度/大小/角度/位置）
- **THEN** 预览区域在 100ms 内更新显示效果

---

### Requirement: 响应式布局
系统 SHALL 支持响应式布局，适配不同屏幕尺寸。

#### Scenario: 移动端布局
- **WHEN** 屏幕宽度小于 768px
- **THEN** 浮动工具栏改为底部显示
- **AND** 缩略图区域可折叠

### Requirement: 高清预览渲染
系统 SHALL 在高 DPI 屏幕（如 Retina 显示器）上提供清晰的图片和水印预览。

#### Scenario: 高 DPI 屏幕渲染
- **WHEN** 用户在高 DPI 屏幕上查看图片预览
- **THEN** Canvas 渲染 SHALL 考虑设备像素比（devicePixelRatio）
- **AND** 图片和水印文字显示清晰无模糊

---

### Requirement: 批量上传长宽比校验
系统 SHALL 在批量模式上传图片时校验长宽比一致性。

#### Scenario: 长宽比一致
- **GIVEN** 当前为批量模式
- **AND** 已有图片（长宽比为 R）
- **WHEN** 用户上传新图片
- **AND** 新图片长宽比在 R ± 1% 范围内
- **THEN** 图片正常添加到列表

#### Scenario: 长宽比不一致
- **GIVEN** 当前为批量模式
- **AND** 已有图片（长宽比为 R）
- **WHEN** 用户上传新图片
- **AND** 新图片长宽比超出 R ± 1% 范围
- **THEN** 显示警告提示"图片长宽比与其他图片不一致，可能影响水印效果"
- **AND** 图片仍然添加到列表

---

### Requirement: 导出信息显示
系统 SHALL 在导出区域显示导出后的尺寸和预估文件大小。

#### Scenario: 单张图片导出信息
- **GIVEN** 已上传单张图片
- **WHEN** 用户查看导出区域
- **THEN** 显示导出尺寸（宽 × 高 像素）
- **AND** 显示预估文件大小（基于格式和质量）

#### Scenario: 批量图片导出信息
- **GIVEN** 当前为批量模式
- **AND** 已上传多张图片
- **WHEN** 用户查看导出区域
- **THEN** 显示当前预览图片的导出尺寸
- **AND** 显示所有图片的总预估文件大小

#### Scenario: JPG 质量影响预估大小
- **WHEN** 用户调整 JPG 质量滑块
- **THEN** 预估文件大小实时更新

---

### Requirement: 单一窗口布局
系统 SHALL 提供单一图片操作窗口布局，包含顶部浮动工具栏区域、中间图片显示区域、底部缩略图区域。

#### Scenario: 默认布局显示
- **WHEN** 用户访问水印工具页面
- **THEN** 显示单一图片操作窗口
- **AND** 顶部工具栏区域默认隐藏
- **AND** 中间为图片显示区域
- **AND** 底部为缩略图区域

#### Scenario: 图片适配显示
- **WHEN** 用户加载图片
- **THEN** 图片按容器大小适配显示
- **AND** 保持图片原始宽高比

---

### Requirement: 添加文字按钮
系统 SHALL 提供添加文字按钮，用于在图片上创建新的文本框。

#### Scenario: 添加文本框
- **WHEN** 用户点击"添加文字"按钮
- **THEN** 在图片中心位置创建一个新的文本框
- **AND** 文本框显示默认文字"水印文字"
- **AND** 新文本框自动被选中

#### Scenario: 添加多个文本框
- **WHEN** 用户多次点击"添加文字"按钮
- **THEN** 每次创建一个新的独立文本框
- **AND** 每个文本框可独立配置

---

### Requirement: 可交互文本框
系统 SHALL 提供可交互的文本框控件，支持拖拽移动、调整大小、旋转角度。

#### Scenario: 选中文本框
- **WHEN** 用户点击图片上的文本框
- **THEN** 该文本框被选中
- **AND** 显示选中边框和控制手柄
- **AND** 顶部浮动工具栏显示

#### Scenario: 拖拽移动文本框
- **WHEN** 用户拖拽选中的文本框
- **THEN** 文本框位置实时跟随鼠标移动
- **AND** 松开鼠标后文本框固定在新位置

#### Scenario: 调整文本框大小
- **WHEN** 用户拖拽文本框边框上的调整手柄
- **THEN** 文本框大小实时变化
- **AND** 字体大小随文本框大小等比例变化

#### Scenario: 旋转文本框
- **WHEN** 用户拖拽文本框的旋转手柄
- **THEN** 文本框角度实时变化
- **AND** 旋转中心为文本框中心点

#### Scenario: 编辑文本内容
- **WHEN** 用户双击文本框
- **THEN** 进入文本编辑模式
- **AND** 可直接输入修改文字内容
- **AND** 点击文本框外部退出编辑模式

#### Scenario: 取消选中
- **WHEN** 用户点击图片空白区域
- **THEN** 取消当前文本框选中状态
- **AND** 隐藏顶部浮动工具栏

---

### Requirement: 浮动工具栏
系统 SHALL 在选中文本框时显示浮动工具栏，提供样式配置功能。

#### Scenario: 显示浮动工具栏
- **WHEN** 用户选中文本框
- **THEN** 在图片顶部显示浮动工具栏
- **AND** 工具栏包含：字体大小、文字颜色、背景色、透明度、复制、删除

#### Scenario: 调整字体大小
- **WHEN** 用户在工具栏调整字体大小
- **THEN** 选中文本框的字体大小实时更新

#### Scenario: 调整文字颜色
- **WHEN** 用户在工具栏选择文字颜色
- **THEN** 选中文本框的文字颜色实时更新

#### Scenario: 调整背景色
- **WHEN** 用户在工具栏选择背景色
- **THEN** 选中文本框的背景色实时更新
- **AND** 背景色应用于文本框容器区域

#### Scenario: 调整透明度
- **WHEN** 用户在工具栏调整透明度
- **THEN** 选中文本框的透明度实时更新
- **AND** 透明度范围为 0%（完全透明）到 100%（完全不透明）

#### Scenario: 复制文本框
- **WHEN** 用户点击工具栏的复制按钮
- **THEN** 创建一个与当前文本框相同配置的新文本框
- **AND** 新文本框位置略微偏移以避免重叠
- **AND** 新文本框自动被选中

#### Scenario: 删除文本框
- **WHEN** 用户点击工具栏的删除按钮
- **THEN** 删除当前选中的文本框
- **AND** 隐藏浮动工具栏

---

### Requirement: 平铺水印配置
系统 SHALL 提供平铺水印作为可选配置项，与文本框水印不冲突。

#### Scenario: 启用平铺水印
- **WHEN** 用户开启平铺水印开关
- **THEN** 显示平铺水印配置面板
- **AND** 图片上显示平铺水印效果

#### Scenario: 配置平铺水印
- **GIVEN** 平铺水印已启用
- **WHEN** 用户调整平铺水印配置（文字、颜色、透明度、间距、角度）
- **THEN** 平铺水印效果实时更新

#### Scenario: 平铺与文本框共存
- **GIVEN** 平铺水印已启用
- **AND** 图片上有文本框水印
- **WHEN** 用户查看图片预览
- **THEN** 同时显示平铺水印和文本框水印
- **AND** 文本框水印显示在平铺水印上层

#### Scenario: 禁用平铺水印
- **WHEN** 用户关闭平铺水印开关
- **THEN** 隐藏平铺水印配置面板
- **AND** 图片上不再显示平铺水印效果

---

### Requirement: 底部缩略图
系统 SHALL 在底部显示已加载图片的缩略图列表，支持批量操作。

#### Scenario: 显示缩略图
- **WHEN** 用户加载多张图片
- **THEN** 底部显示所有图片的缩略图
- **AND** 当前预览的图片缩略图高亮显示

#### Scenario: 切换预览图片
- **WHEN** 用户点击某张缩略图
- **THEN** 中间区域切换显示该图片
- **AND** 保持当前的水印配置

#### Scenario: 删除图片
- **WHEN** 用户点击缩略图上的删除按钮
- **THEN** 从列表中移除该图片

#### Scenario: 添加更多图片
- **WHEN** 用户点击底部的添加按钮
- **THEN** 打开文件选择器
- **AND** 支持多选图片文件

---

