## ADDED Requirements

### Requirement: 高清预览渲染
系统 SHALL 在高 DPI 屏幕（如 Retina 显示器）上提供清晰的图片和水印预览。

#### Scenario: 高 DPI 屏幕渲染
- **WHEN** 用户在高 DPI 屏幕上查看图片预览
- **THEN** Canvas 渲染 SHALL 考虑设备像素比（devicePixelRatio）
- **AND** 图片和水印文字显示清晰无模糊

---

## MODIFIED Requirements

### Requirement: 水印颜色配置
系统 SHALL 允许用户配置水印颜色，并提供清晰可辨的颜色预设。

#### Scenario: 选择水印颜色
- **WHEN** 用户通过颜色选择器选择颜色
- **THEN** 预览区域的水印颜色实时更新

#### Scenario: 白色预设显示
- **WHEN** 颜色选择器显示预设颜色
- **THEN** 白色预设 SHALL 显示边框以便在浅色背景下可见

#### Scenario: 重置配置
- **WHEN** 用户点击"重置配置"按钮
- **THEN** 所有水印配置恢复为推荐默认值
- **AND** 推荐默认值为：颜色 #333333，透明度 25%，字体大小 48px，角度 -30°，间距 150px

---

### Requirement: 可拖拽水印（单个模式）
系统 SHALL 在单个模式下支持添加多个可拖拽水印。

#### Scenario: 添加水印
- **GIVEN** 当前为单个模式
- **AND** 图片已加载
- **WHEN** 用户点击"添加水印"按钮
- **THEN** 在图片中心位置添加一个新水印
- **AND** 新水印显示可视边框

#### Scenario: 选择水印
- **GIVEN** 当前为单个模式
- **AND** 图片上有多个水印
- **WHEN** 用户点击某个水印
- **THEN** 该水印被选中并高亮显示边框
- **AND** 其他水印边框变为普通样式

#### Scenario: 拖拽水印位置
- **GIVEN** 当前为单个模式
- **AND** 图片已加载
- **WHEN** 用户在预览区域拖拽水印
- **THEN** 水印位置实时跟随鼠标移动
- **AND** 松开鼠标后水印固定在新位置

#### Scenario: 删除水印
- **GIVEN** 当前为单个模式
- **AND** 图片上有水印
- **WHEN** 用户点击水印右上角的删除按钮
- **THEN** 该水印从图片上移除

---

### Requirement: 水印位置选择（批量模式）
系统 SHALL 在批量模式下通过第一张图片的拖拽定位来设置所有图片的水印位置。

#### Scenario: 拖拽定位水印
- **GIVEN** 当前为批量模式
- **AND** 已上传多张图片
- **WHEN** 用户在第一张图片上拖拽水印到指定位置
- **THEN** 水印位置以相对坐标（百分比）记录
- **AND** 所有图片的水印统一显示在该相对位置

---

### Requirement: 批量上传长宽比校验
系统 SHALL 在批量模式上传图片时校验长宽比一致性。

#### Scenario: 长宽比一致
- **GIVEN** 当前为批量模式
- **AND** 已有图片（长宽比为 R）
- **WHEN** 用户上传新图片
- **AND** 新图片长宽比在 R ± 1% 范围内
- **THEN** 图片正常添加到列表

#### Scenario: 长宽比不一致
- **GIVEN** 当前为批量模式
- **AND** 已有图片（长宽比为 R）
- **WHEN** 用户上传新图片
- **AND** 新图片长宽比超出 R ± 1% 范围
- **THEN** 显示警告提示"图片长宽比与其他图片不一致，可能影响水印效果"
- **AND** 图片仍然添加到列表

---

### Requirement: 导出信息显示
系统 SHALL 在导出区域显示导出后的尺寸和预估文件大小。

#### Scenario: 单张图片导出信息
- **GIVEN** 已上传单张图片
- **WHEN** 用户查看导出区域
- **THEN** 显示导出尺寸（宽 × 高 像素）
- **AND** 显示预估文件大小（基于格式和质量）

#### Scenario: 批量图片导出信息
- **GIVEN** 当前为批量模式
- **AND** 已上传多张图片
- **WHEN** 用户查看导出区域
- **THEN** 显示当前预览图片的导出尺寸
- **AND** 显示所有图片的总预估文件大小

#### Scenario: JPG 质量影响预估大小
- **WHEN** 用户调整 JPG 质量滑块
- **THEN** 预估文件大小实时更新

